// 
// Decompiled by Procyon v0.5.36
// 

package xyz.natalczx.cerberus.check.other;

import org.bukkit.inventory.meta.BookMeta;
import org.bukkit.event.player.PlayerEditBookEvent;
import org.bukkit.event.EventHandler;
import java.util.Iterator;
import org.bukkit.entity.Player;
import org.bukkit.inventory.ItemStack;
import org.bukkit.enchantments.Enchantment;
import org.bukkit.Material;
import org.bukkit.event.player.PlayerInteractEvent;
import xyz.natalczx.cerberus.CerberusAntiCheat;
import xyz.natalczx.cerberus.check.Check;

public class Exploit extends Check
{
    public Exploit(final CerberusAntiCheat AntiCheat) {
        super("Exploit", "Exploit", AntiCheat);
    }
    
    @EventHandler
    public void onDamage(final PlayerInteractEvent event) {
        final Player attacker;
        final ItemStack is;
        final Iterator<Enchantment> iterator;
        Enchantment ench;
        this.async(() -> {
            attacker = event.getPlayer();
            is = attacker.getItemInHand();
            if (is != null) {
                if (is.getType() == Material.BOOK_AND_QUILL || is.getType() == Material.WRITTEN_BOOK) {
                    if (is.getEnchantments().size() > 0) {
                        is.getEnchantments().keySet().iterator();
                        while (iterator.hasNext()) {
                            ench = iterator.next();
                            is.removeEnchantment(ench);
                        }
                        event.setCancelled(true);
                        this.getAnticheat().failure(this, attacker, "Book and Quill Exploit", (String[])null);
                        attacker.getInventory().removeItem(new ItemStack[] { is });
                    }
                }
            }
        });
    }
    
    @EventHandler
    public void onEdit(final PlayerEditBookEvent event) {
        final BookMeta book;
        this.async(() -> {
            book = event.getNewBookMeta();
            if (book.getEnchants().size() > 0) {
                event.setCancelled(true);
                event.getPlayer().getInventory().remove(Material.BOOK_AND_QUILL);
                this.getAnticheat().failure(this, event.getPlayer(), "Book and Quill Exploit", (String[])null);
            }
        });
    }
}
